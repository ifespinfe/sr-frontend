import{A as ae,_ as oe}from"./S27SpC1F.js";import{_ as ie}from"./BKCTQd3a.js";import{_ as F}from"./SSGQ2eoQ.js";import{h as z,J as de,r as V,l as re,f as le,o as l,c as y,n as e,b as s,L as P,v as k,a as t,F as L,E as j,d as R,t as f,w as a,_ as q,s as Q,p as w,G as X,H as Y,K as ue,z as M,X as W,U as ce,M as pe,N as me,O as Z,P as ee,Q as te,k as se,j as U,R as fe,C as _e,A as ge,B as ve,D as ye,m as he}from"./CRKMsqI1.js";import{_ as qe}from"./CFP0A4w_.js";import{_ as be}from"./B0Ww4se5.js";import{_ as T}from"./DhdCCdzQ.js";import{_ as xe}from"./CHhDqFdS.js";import{_ as I,e as O}from"./FIo-Aeg1.js";import{u as B}from"./qm2qZ2xd.js";import{C as we}from"./BWcu647R.js";import{C as ne}from"./DdPzLAb7.js";import{D as J}from"./BckML-4P.js";import{u as $e}from"./CZgaGouz.js";import{_ as ke}from"./BJ7mrQqS.js";import{u as Ue}from"./QkMyHs9f.js";import"./lmvGdM2p.js";import"./BOinvJEq.js";import"./HNthaV9g.js";import"./CLTMpQKm.js";import"./DPc4cBMH.js";import"./DadTkFI4.js";const Ce={class:"w-full border rounded-3xl bg-white/5 px-6 py-4 relative"},Re={key:0,class:"absolute inset-0 grid place-items-center bg-background/65 rounded-[inherit] z-10"},ze={class:"space-y-6 my-8"},Ee={class:"text-lg text-muted-foreground capitalize min-w-fit"},Le=z({__name:"event-rate-card",props:{services:{default:()=>[{id:1,name:"song",price:0},{id:2,name:"hype",price:0}]},onUpdate:{}},setup(b){const _=b,{refreshNotifications:i}=de(),m=V(!1),g=V([]);re(()=>_.services,d=>{g.value=d},{immediate:!0});const{$repo:{event:r}}=le(),o=async(d,n)=>await r.updateEventPrice(d,n),v=async()=>{var d;try{m.value=!0;const n=await Promise.all(g.value.map(c=>o(c.id,c.price)));i(),m.value=!1,Q({title:"Prices updated"})}catch(n){const c=n;m.value=!1,Q({title:((d=c==null?void 0:c.data)==null?void 0:d.message)??"Failed to update prices",variant:"warning"}),console.error("FAILED TO UPDATE PRICES",c)}};return(d,n)=>(l(),y("div",Ce,[e(m)?(l(),y("div",Re,[s(e(P),{class:"size-5 animate-spin"})])):k("",!0),n[5]||(n[5]=t("div",{class:"text-2xl font-medium"},"Live prices",-1)),t("div",ze,[(l(!0),y(L,null,j(e(g),c=>(l(),y("div",{class:"flex justify-between items-center",key:c.id},[t("div",Ee,[R(f(c.name)+" ",1),n[0]||(n[0]=t("span",{class:"hidden md:inline"},"request",-1))]),s(qe,{modelValue:c.price,"onUpdate:modelValue":C=>c.price=C,id:`PRICE-FOR-${c.name}-${c.id}`,step:100},null,8,["modelValue","onUpdate:modelValue","id"]),k("",!0)]))),128))]),s(q,{class:"w-full",onClick:v},{default:a(()=>n[4]||(n[4]=[R("Update price")])),_:1})]))}}),Ne={class:"space-y-1 text-left"},Se={class:"font-medium"},De={class:"text-sm text-muted-foreground"},Be={class:"py-4 mt-4 border-t border-t-white/5"},Ae={class:"flex gap-x-2"},Ve={class:"space-y-1 w-full"},Te={class:"text-white/80"},Fe={class:"space-y-1 w-full"},Pe={class:"tabular-nums text-white/80"},je={key:0,class:"flex gap-x-4 mt-8"},Me={key:1,class:"py-1 px-6 bg-foreground text-background text-center text-sm mt-8 rounded-3xl animate-pulse"},Ie=z({__name:"request-collapsible-item",props:{request:{},index:{},onUpdate:{},defaultOpen:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1}},setup(b){const _=b,i=V(_.defaultOpen),m=V(!1),{updateEventRequest:g,update_status:r,updating:o}=B(),v=()=>{_.disabled||m.value||(i.value=!i.value)},d=n=>{g(_.request.id,n,_.onUpdate)};return(n,c)=>{const C=ce,N=pe,h=me;return l(),w(h,{class:"bg-white/5 rounded-2xl",open:e(i),disabled:n.disabled},{default:a(()=>[s(C,{asChild:""},{default:a(()=>{var p;return[t("div",{onClick:v,class:"grid grid-cols-[auto_1fr_auto] gap-x-4 w-full items-center justify-start relative px-4 sm:px-6 py-3 [&[data-state='open']_.caret]:rotate-180 cursor-pointer"},[t("div",{class:X(("cn"in n?n.cn:e(Y))(n.request.status==="now-playing"?"text-primary text-base font-medium":"text-foreground"))},f(n.index??"-"),3),t("div",Ne,[n.request.type==="hype"?(l(),w(I,{key:0,content:(p=n.request)==null?void 0:p.description,modelValue:e(m),"onUpdate:modelValue":c[0]||(c[0]=u=>ue(m)?m.value=u:null)},null,8,["content","modelValue"])):(l(),y(L,{key:1},[t("div",Se,f(n.request.song_title),1),t("div",De," by "+f(n.request.artist),1)],64))]),s(e(we),{class:"size-5 caret transition-transform relative"})])]}),_:1}),s(N,{class:"data-[state=open]:animate-collapsibleSlideDown data-[state=closed]:animate-collapsibleSlideUp overflow-hidden px-4 sm:px-6"},{default:a(()=>[t("div",Be,[t("div",Ae,[t("div",Ve,[c[2]||(c[2]=t("div",{class:"text-sm text-muted-foreground"},"Requested by",-1)),t("div",Te,f(n.request.nickname??n.request.audience.name),1)]),t("div",Fe,[c[3]||(c[3]=t("div",{class:"text-sm text-muted-foreground"},"Amount paid",-1)),t("div",Pe," ₦"+f(("formatMoney"in n?n.formatMoney:e(M))(n.request.price)),1)])]),n.request.status==="new"?(l(),y("div",je,[s(q,{class:"w-full",disabled:e(o),loading:e(o)&&e(r)==="now-playing",onClick:c[1]||(c[1]=p=>d("now-playing"))},{default:a(()=>[R(f(n.request.type==="hype"?"Perform":"Play")+" ",1),s(e(ne),{class:"size-4 ml-2"})]),_:1},8,["disabled","loading"]),s(F,{onConfirm:()=>d("declined")},{default:a(()=>[s(q,{variant:"secondary",class:"w-full !border-destructive !text-destructive",disabled:e(o),loading:e(o)&&e(r)==="declined"},{default:a(()=>[c[4]||(c[4]=R(" Reject ")),s(e(W),{class:"size-4 ml-2"})]),_:1},8,["disabled","loading"])]),_:1},8,["onConfirm"])])):n.request.status==="now-playing"?(l(),y("div",Me," Now "+f(n.request.type==="hype"?"performing hype":"playing"),1)):k("",!0)])]),_:1})]),_:1},8,["open","disabled"])}}}),Oe={class:"grid grid-cols-request-line-item gap-x-4 items-center px-2 sm:px-6 py-4 bg-white/5 rounded-2xl"},He={class:"space-y-1"},Ge={class:"font-medium"},Qe={class:"text-sm text-muted-foreground"},Je={class:"space-y-1"},Ke={class:"text-white/80"},Xe={class:"space-y-1"},Ye={class:"tabular-nums text-white/80"},We={key:0,class:"flex gap-x-2 justify-self-end"},Ze={key:1,class:"py-1 px-6 bg-foreground text-background text-center text-sm rounded-2xl animate-pulse justify-self-end"},et=z({__name:"request-line-item",props:{request:{},index:{},onUpdate:{type:Function}},setup(b){const _=b,{updateEventRequest:i,update_status:m,updating:g}=B(),r=o=>{i(_.request.id,o,_.onUpdate)};return(o,v)=>{var d;return l(),y("div",Oe,[t("div",{class:X(("cn"in o?o.cn:e(Y))(o.request.status==="now-playing"?"text-primary text-base font-medium":"text-foreground"))},f(o.index??"-"),3),t("div",He,[o.request.type==="hype"?(l(),w(I,{key:0,content:(d=o.request)==null?void 0:d.description},null,8,["content"])):(l(),y(L,{key:1},[t("div",Ge,f(o.request.song_title),1),t("div",Qe,"by "+f(o.request.artist),1)],64))]),t("div",Je,[v[1]||(v[1]=t("div",{class:"text-sm text-muted-foreground"},"Requested by",-1)),t("div",Ke,f(o.request.nickname??o.request.audience.name),1)]),t("div",Xe,[v[2]||(v[2]=t("div",{class:"text-sm text-muted-foreground"},"Amount paid",-1)),t("div",Ye," ₦"+f(("formatMoney"in o?o.formatMoney:e(M))(o.request.price)),1)]),o.request.status==="new"?(l(),y("div",We,[s(q,{onClick:v[0]||(v[0]=n=>r("now-playing")),disabled:e(g),loading:e(g)&&e(m)==="now-playing"},{default:a(()=>[R(f(o.request.type==="hype"?"Perform":"Play")+" ",1),s(e(ne),{class:"size-3 ml-2"})]),_:1},8,["disabled","loading"]),s(F,{onConfirm:()=>r("declined"),message:"Are you sure you want to reject this request?"},{default:a(()=>[s(q,{variant:"secondary",disabled:e(g),loading:e(g)&&e(m)==="declined",class:"!border-destructive !text-destructive"},{default:a(()=>[v[3]||(v[3]=R(" Reject ")),s(e(W),{class:"size-3 ml-2"})]),_:1},8,["disabled","loading"])]),_:1},8,["onConfirm"])])):o.request.status==="now-playing"?(l(),y("div",Ze," Now "+f(o.request.type==="hype"?"performing hype":"playing"),1)):k("",!0)])}}}),tt={key:0,class:"min-h-[350px]"},st={class:"place-center grid place-items-center gap-2"},nt={class:"size-12 rounded-full bg-white/40 relative"},at={class:"text-xl text-muted-foreground font-medium"},K=z({__name:"request-list",props:{requests:{default:()=>O},onUpdate:{},type:{default:"song"},loading:{type:Boolean,default:!1}},setup(b){const _=i=>{i.preventDefault()};return(i,m)=>{const g=Z,r=T,o=ee,v=te;return l(),w(v,null,{default:a(()=>[s(o,{class:"space-y-2 relative"},{default:a(()=>[(l(!0),y(L,null,j(i.requests,(d,n)=>(l(),w(g,{key:d.id,value:d.id,onSelect:_},{default:a(()=>[s(Ie,{request:d,class:"min-[880px]:hidden",index:n+1,onUpdate:i.onUpdate,"default-open":d.status==="now-playing",disabled:d.status==="now-playing"},null,8,["request","index","onUpdate","default-open","disabled"]),s(et,{request:d,class:"hidden min-[880px]:grid",index:n+1,onUpdate:i.onUpdate},null,8,["request","index","onUpdate"])]),_:2},1032,["value"]))),128)),!i.requests.length&&!i.loading?(l(),y("div",tt,[t("div",st,[t("div",nt,[s(r,{class:"scale-75 place-center",name:i.type=="song"?"music":"mic"},null,8,["name"])]),t("div",at," No "+f(i.type)+" requests ",1),m[0]||(m[0]=t("div",{class:"text-muted-foreground"}," Get prepared, requests may come soon ",-1))])])):k("",!0)]),_:1})]),_:1})}}}),ot={class:"grid md:grid-cols-[70px_1fr] gap-2 px-2 sm:px-6 py-4 b-white/5 rounded-2xl text-muted-foreground"},it={class:"grid md:grid-cols-[1fr_200px] gap-2 items-center"},dt={class:"space-y-1"},rt={class:"flex gap-x-2 items-center"},lt={class:"text-base text-foreground font-medium"},ut={class:"text-sm"},ct={class:"flex gap-x- items-center"},pt={class:"flex items-center gap-x-1"},mt={class:"uppercase"},ft={class:"tabular-nums"},_t={class:"flex gap-x-1 md:justify-end items-center text-sm"},gt={class:"capitalize"},vt=z({__name:"request-history-line-item",props:{request:{},index:{},onUpdate:{type:Function}},setup(b){const _=b,{updateEventRequest:i,updating:m}=B(),g=r=>{i(_.request.id,r,_.onUpdate)};return(r,o)=>{const v=T,d=q;return l(),y("div",ot,[t("div",null,f(("useDateFormat"in r?r.useDateFormat:e($e))(new Date(r.request.created_at),"h:mma")),1),t("div",it,[t("div",dt,[t("div",rt,[r.request.type==="hype"?(l(),w(I,{key:0,content:r.request.description,class:"text-base text-foreground font-medium"},null,8,["content"])):(l(),y(L,{key:1},[t("div",lt,f(r.request.song_title),1),t("div",ut,"by "+f(r.request.artist),1)],64))]),t("div",ct,[t("div",null,f(r.request.nickname??r.request.audience.name),1),s(e(J)),t("div",pt,[s(v,{class:"scale-50",name:r.request.type=="song"?"music":"mic"},null,8,["name"]),t("div",mt,f(r.request.type),1)]),s(e(J)),t("div",ft,"₦"+f(("formatMoney"in r?r.formatMoney:e(M))(r.request.price)),1)])]),t("div",_t,[t("div",gt,f(r.request.status),1),(["ignored","declined"].includes(r.request.status),k("",!0))])])])}}}),yt={key:0,class:"min-h-[350px]"},ht={class:"place-center grid place-items-center gap-2 text-center"},qt={class:"size-12 rounded-full bg-white/40 relative"},bt=z({__name:"request-history-list",props:{requests:{default:()=>O},onUpdate:{},loading:{type:Boolean,default:!1}},setup(b){const _=i=>{i.preventDefault()};return(i,m)=>{const g=Z,r=T,o=ee,v=te;return l(),w(v,null,{default:a(()=>[s(o,{class:"space-y-2 relative"},{default:a(()=>[(l(!0),y(L,null,j(i.requests,d=>(l(),w(g,{key:d.id,value:d.id,onSelect:_},{default:a(()=>[s(vt,{request:d,onUpdate:i.onUpdate},null,8,["request","onUpdate"])]),_:2},1032,["value"]))),128)),!i.requests.length&&!i.loading?(l(),y("div",yt,[t("div",ht,[t("div",qt,[s(r,{class:"scale-75 place-center",name:"history"})]),m[0]||(m[0]=t("div",{class:"text-xl text-muted-foreground font-medium"}," Nothing yet ",-1)),m[1]||(m[1]=t("div",{class:"text-muted-foreground"}," Your completed/rejected requests will be here ",-1))])])):k("",!0)]),_:1})]),_:1})}}}),xt={class:"size-5 text-sm bg-secondary text-destructive rounded-full font-semibold count"},wt={class:"size-5 text-sm bg-secondary text-destructive rounded-full font-semibold count"},$t={class:"md:hidden"},kt={key:2,class:"py-8 absolute inset-0 bg-white/5 rounded-[inherit] grid place-items-center z-10"},Ut={key:1,class:"grid place-items-center gap-y-4"},Ct={class:"text-destructive text-center"},Rt=z({__name:"requests-tab",props:{requests:{default:()=>O},event_id:{default:"1"}},setup(b){const _=b,i=se(),m=U(()=>{var p;return(p=i==null?void 0:i.query)==null?void 0:p.request_tab}),g=U(()=>m.value??"song"),{fetchEventRequests:r}=B(),{data:o,status:v,error:d,refresh:n}=fe(`EVENT-${_.event_id}-REQUESTS`,()=>r(_.event_id),{transform:p=>{const u={"now-playing":0,new:1,"payment-pending":2,completed:3,declined:4,ignored:5};return p.data.sort(($,x)=>(u==null?void 0:u[$.status])-u[x.status])}}),c=U(()=>{var p;return!o.value||d.value?[]:(p=o.value)==null?void 0:p.filter(u=>u.status==="new"||u.status==="now-playing")}),C=U(()=>{var p;return!o.value||d.value?[]:(p=o.value)==null?void 0:p.filter(u=>u.status!=="new"&&u.status!=="now-playing")}),N=U(()=>c.value.filter(p=>p.type==="song")),h=U(()=>c.value.filter(p=>p.type==="hype"));return(p,u)=>{const $=be,x=_e,E=ge,D=T,S=ve,A=ye;return l(),w(A,{class:"border bg-white/5 rounded-3xl relative","default-value":e(g)},{default:a(()=>{var H,G;return[e(g)==="history"?(l(),w(E,{key:0,class:"p-4 border-b grid grid-cols-[auto_1fr] gap-x-4 items-center min-h-[73px] transition-opacity duration-1000"},{default:a(()=>[u[2]||(u[2]=t("div",{class:"text-lg font-medium pl-6 hidden md:block"},"Request history",-1)),s(x,{value:"song","as-child":""},{default:a(()=>[s($,{replace:"",to:{query:{...e(i).query,request_tab:"song"}},class:"flex items-center gap-x-1 ml-auto pr-6"},{default:a(()=>[s(q,{variant:"outline",size:"icon"},{default:a(()=>[s(e(ae))]),_:1}),u[1]||(u[1]=t("div",null,"Back to live request",-1))]),_:1},8,["to"])]),_:1})]),_:1})):(l(),w(E,{key:1,class:"p-4 border-b grid grid-cols-[auto_auto_1fr] gap-x-4 items-center -z-10"},{default:a(()=>[s(x,{value:"song","as-child":""},{default:a(()=>[s($,{replace:"",to:{query:{...e(i).query,request_tab:"song"}},class:"[&[data-state='active']_.count]:hidden"},{default:a(()=>[s(q,{variant:e(g)==="song"?"primary":"outline",class:"gap-x-2 md:min-w-[100px]"},{default:a(()=>[u[3]||(u[3]=t("div",null,"song",-1)),t("div",xt,f(e(N).length),1)]),_:1},8,["variant"])]),_:1},8,["to"])]),_:1}),s(x,{value:"hype","as-child":""},{default:a(()=>[s($,{replace:"",to:{query:{...e(i).query,request_tab:"hype"}},class:"[&[data-state='active']_.count]:hidden"},{default:a(()=>[s(q,{variant:e(g)==="hype"?"primary":"outline",class:"gap-x-2 md:min-w-[100px]"},{default:a(()=>[u[4]||(u[4]=t("div",null,"hype",-1)),t("div",wt,f(e(h).length),1)]),_:1},8,["variant"])]),_:1},8,["to"])]),_:1}),s(x,{value:"history","as-child":""},{default:a(()=>[s($,{to:{query:{...e(i).query,request_tab:"history"}},replace:"",class:"ml-auto"},{default:a(()=>[s(q,{variant:"ghost",class:"gap-x-2 text-muted-foreground hidden md:inline-flex"},{default:a(()=>[s(D,{name:"history"}),u[5]||(u[5]=t("div",null,"Request history",-1))]),_:1}),t("div",$t,[s(xe,{message:"Request history"},{default:a(()=>[s(q,{variant:"ghost",size:"icon"},{default:a(()=>[s(D,{name:"history"})]),_:1})]),_:1})])]),_:1},8,["to"])]),_:1})]),_:1})),e(v)=="pending"||e(d)?(l(),y("div",kt,[e(v)==="pending"?(l(),w(e(P),{key:0,class:"size-5 animate-spin"})):e(d)?(l(),y("div",Ut,[t("div",Ct,f(((G=(H=e(d))==null?void 0:H.data)==null?void 0:G.message)??"Failed to load request"),1),s(q,{variant:"secondary",onClick:u[0]||(u[0]=()=>e(n)())},{default:a(()=>u[6]||(u[6]=[R(" Retry ")])),_:1})])):k("",!0)])):k("",!0),e(d)?k("",!0):(l(),y(L,{key:3},[s(S,{value:"song"},{default:a(()=>[s(K,{type:"song",loading:e(v)==="pending",requests:e(N),onUpdate:e(n),class:"p-4"},null,8,["loading","requests","onUpdate"])]),_:1}),s(S,{value:"hype",class:"p-4"},{default:a(()=>[s(K,{type:"hype",loading:e(v)==="pending",requests:e(h),onUpdate:e(n)},null,8,["loading","requests","onUpdate"])]),_:1}),s(S,{value:"history",class:"p-4"},{default:a(()=>[s(bt,{loading:e(v)==="pending",requests:e(C),onUpdate:e(n)},null,8,["loading","requests","onUpdate"])]),_:1})],64))]}),_:1},8,["default-value"])}}}),zt={class:"container py-20"},Et={class:"flex items-center gap-x-2"},Lt={class:"text-foreground font-medium text-lg"},Nt={class:"grid xl:grid-cols-[1fr_auto] items-start gap-4"},St={class:"xl:max-w-[900px]"},Dt={class:"max-w-[700px] mx-auto w-full xl:w-[380px] relative"},Bt={key:0,class:"absolute inset-0 grid place-items-center bg-background/40"},as=z({__name:"index",setup(b){const _=se(),{endEvent:i,ending:m}=B(),{data:g,error:r,status:o,refresh:v}=Ue(`/events/${_.params.id}`),d=()=>{i(_.params.id)},n=U(()=>{var h;return(h=_==null?void 0:_.query)==null?void 0:h.request_tab}),c=U(()=>_.params.id),C=U(()=>{var h,p,u,$,x;return(p=(h=g.value)==null?void 0:h.data)!=null&&p.requests?(x=($=(u=g.value)==null?void 0:u.data)==null?void 0:$.requests)==null?void 0:x.filter(E=>E.status==="new"):[]}),N=U(()=>{var p;const h=(p=C==null?void 0:C.value)==null?void 0:p.length;return h?`Ending the event will reject all pending ${h} requests. Are you sure you want to end event?`:"Are you sure you want to end event?"});return he({title:()=>n.value==="history"?"Request History":"Song and Hype Request List"}),(h,p)=>{var x,E,D;const u=oe,$=ie;return l(),y("div",null,[s(ke,{ending:e(m),onEndEvent:d,"start-date":(x=e(g))==null?void 0:x.data.start_date,animate:""},null,8,["ending","start-date"]),t("div",zt,[t("div",Et,[s(u,{to:"/dashboard"}),t("div",Lt,f((D=(E=e(g))==null?void 0:E.data)==null?void 0:D.title),1)]),s($,{error:e(r),class:"mt-8",loading:e(m)},{default:a(()=>{var S,A;return[t("div",Nt,[t("div",St,[s(Rt,{event_id:e(c)},null,8,["event_id"])]),t("div",Dt,[e(o)==="pending"?(l(),y("div",Bt,[s(e(P),{class:"size-5 animate-spin"})])):k("",!0),s(Le,{services:((A=(S=e(g))==null?void 0:S.data)==null?void 0:A.types)??[],onUpdate:e(v)},null,8,["services","onUpdate"]),s(F,{onConfirm:d,message:e(N)},{default:a(()=>[s(q,{class:"w-full mt-6",variant:"destructive",size:"lg",loading:e(m)},{default:a(()=>p[0]||(p[0]=[R(" END EVENT ")])),_:1},8,["loading"])]),_:1},8,["message"])])])]}),_:1},8,["error","loading"])])])}}});export{as as default};
